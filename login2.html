<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sign in ‚Äî ScaleVest</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* CSS remains exactly as you provided for styling */
    *{box-sizing:border-box;font-family:Inter}
    body{margin:0;color:#fff;background:#0a0f19}
    #bgVideo{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:-2}
    body::before{content:"";position:fixed;inset:0;background:rgba(10,15,25,.45);z-index:-1}
    .auth-btn{display:flex;align-items:center;gap:12px;width:100%;padding:13px 16px;margin-bottom:12px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;font-weight:600;cursor:pointer;color:#000;font-size:14px}
    .auth-btn:hover{background:#f9fafb}
    .modal-overlay,.email-overlay{position:fixed;inset:0;display:flex;justify-content:center;align-items:center}
    .email-overlay{background:rgba(0,0,0,.45);backdrop-filter:blur(8px);display:none;z-index:100}
    .email-glass{width:360px;padding:28px;border-radius:20px;background:rgba(255,255,255,.15);backdrop-filter:blur(20px)}
    .email-glass h3{margin-top:0;color:#fff}
    .email-glass input{width:100%;padding:12px;margin-bottom:10px;border-radius:10px;border:none;background:rgba(255,255,255,.2);color:#fff;font-size:14px}
    .email-glass input::placeholder{color:rgba(255,255,255,.6)}
    .email-glass button{width:100%;padding:12px;border:none;border-radius:12px;background:#2563eb;color:#fff;font-weight:600;cursor:pointer;font-size:14px}
    ul{margin:6px 0 14px 14px;padding:0;font-size:12px;line-height:1.6;color:#fff}
    .modal{width:900px;height:520px;background:#fff;border-radius:16px;display:flex;overflow:hidden}
    .modal-left{width:50%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);position:relative}
    .modal-left::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,.25)}
    .overlay-text{position:relative;z-index:2;padding:42px;color:#fff}
    .modal-right{width:50%;padding:40px;color:#000}
    .modal-right h3{margin-top:0;font-size:24px}
    .modal-right p{font-size:14px;color:#6b7280}
    #authSwitch{cursor:pointer}
    #authSwitch span{color:#2563eb;font-weight:600}
    .divider{text-align:center;margin:18px 0;position:relative}
    .divider span{background:#fff;padding:0 10px;font-size:12px;color:#6b7280}
    .divider::before{content:"";position:absolute;top:50%;left:0;right:0;height:1px;background:#e5e7eb;z-index:-1}
    .loader{width:42px;height:42px;border:4px solid rgba(255,255,255,.3);border-top:4px solid #60a5fa;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 14px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .error-msg{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#ef4444;padding:10px;border-radius:8px;font-size:13px;margin-bottom:12px;display:none}
</style>
</head>

<body>

<video id="bgVideo" autoplay muted loop playsinline>
  <source src="loginpage.mp4" type="video/mp4">
</video>

<div class="modal-overlay">
  <div class="modal">
    <div class="modal-left">
      <div class="overlay-text">
        <h2>Verified ‚Ä¢ Secure ‚Ä¢ Scalable</h2>
        <p>Join thousands of businesses scaling with confidence</p>
      </div>
    </div>
    <div class="modal-right">
      <h3 id="authTitle">New to ScaleVest?</h3>
      <p id="authSubtitle">Create an account to get started</p>
      <p id="authSwitch">Already have an account? <span onclick="switchToSigninUI()">Sign in</span></p>
      <button class="auth-btn" onclick="googleLogin()"><span>üîµ</span> Continue with Google</button>
      <button class="auth-btn" onclick="emailAuthHandler()"><span>‚úâÔ∏è</span> Continue with Email</button>
      <div class="divider"><span>or</span></div>
      <button class="auth-btn" onclick="appleLogin()"><span>üçé</span> Continue with Apple</button>
      <button class="auth-btn" onclick="facebookLogin()"><span>üìò</span> Continue with Facebook</button>
    </div>
  </div>
</div>

<div class="email-overlay" id="signupModal">
  <div class="email-glass">
    <h3>Create account</h3>
    <div class="error-msg" id="signupError"></div>
    <input id="signupEmail" type="email" placeholder="Email">
    <input id="signupPassword" type="password" placeholder="Password" oninput="checkPasswordRules()">
    <ul>
      <li id="rule_length">‚ùå At least 6 characters</li>
      <li id="rule_number">‚ùå Contains a number</li>
      <li id="rule_special">‚ùå Contains a special character</li>
    </ul>
    <button onclick="emailSignup()">Create account</button>
    <p style="text-align:center;font-size:12px;margin-top:12px;color:#fff;"><span style="cursor:pointer" onclick="closeModals()">‚Üê Back</span></p>
  </div>
</div>

<div class="email-overlay" id="signinModal">
  <div class="email-glass">
    <h3>Sign in</h3>
    <div class="error-msg" id="signinError"></div>
    <input id="signinEmail" type="email" placeholder="Email">
    <input id="signinPassword" type="password" placeholder="Password">
    <button onclick="emailSignin()">Sign in</button>
    <p style="text-align:right;font-size:12px;margin-top:8px;"><span style="cursor:pointer;color:#93c5fd" onclick="forgotPassword()">Forgot password?</span></p>
    <div class="divider"><span>or</span></div>
    <button class="auth-btn" onclick="googleLogin()"><span>üîµ</span> Continue with Google</button>
    <p style="text-align:center;font-size:12px;margin-top:12px;color:#fff;"><span style="cursor:pointer" onclick="closeModals()">‚Üê Back</span></p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Initialize Firebase
firebase.initializeApp({
  apiKey: "AIzaSyD6PdrKp2XLfRqjC587lMpdKTaWD4MBens",
  authDomain: "scalevest-163a0.firebaseapp.com",
  projectId: "scalevest-163a0"
});

const auth = firebase.auth();
const db = firebase.firestore();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

let isAuthFlowActive = false;

/* --- SMART REDIRECT LOGIC --- */
async function performSmartRedirect(user) {
    if (!user) return;
    try {
        // We check Firestore to see if the founder profile document exists
        const docRef = db.collection("startupprofile").doc(user.uid);
        const docSnap = await docRef.get();

        if (docSnap.exists) {
            // Profile exists in DB -> Go to Dashboard
            localStorage.setItem('startupProfileCreated', 'true'); // Keep local storage in sync
            window.location.href = "founderdashboard.html";
        } else {
            // No profile in DB -> Go to Setup
            localStorage.removeItem('startupProfileCreated');
            window.location.href = "startup-side.html";
        }
    } catch (error) {
        console.error("Redirect Error:", error);
        // Fallback to config if DB is unreachable
        window.location.href = "founderandstartupconfig.html";
    }
}

/* UI HELPERS */
function emailAuthHandler(){ signupModal.style.display="flex"; signupError.style.display="none"; }
function switchToSigninUI(){ signupModal.style.display="none"; signinModal.style.display="flex"; }
function closeModals(){ signupModal.style.display="none"; signinModal.style.display="none"; }
function checkPasswordRules(){
    const p = signupPassword.value;
    rule_length.innerText=(p.length>=6?"‚úÖ":"‚ùå")+" At least 6 characters";
    rule_number.innerText=(/\d/.test(p)?"‚úÖ":"‚ùå")+" Contains a number";
    rule_special.innerText=(/[!@#$%^&*]/.test(p)?"‚úÖ":"‚ùå")+" Contains a special character";
}
function validPassword(p){ return p.length>=6 && /\d/.test(p) && /[!@#$%^&*]/.test(p); }
function showError(elementId, message){ const el = document.getElementById(elementId); el.innerText = message; el.style.display = "block"; }

/* --- AUTH ACTIONS --- */

async function emailSignup() {
    const email = signupEmail.value.trim();
    const password = signupPassword.value;
    if (!email || !validPassword(password)) { showError('signupError', 'Invalid details'); return; }

    isAuthFlowActive = true;
    try {
        await auth.createUserWithEmailAndPassword(email, password);
        window.location.href = "founderandstartupconfig.html";
    } catch (err) {
        isAuthFlowActive = false;
        showError('signupError', err.message);
    }
}

async function emailSignin() {
    const email = signinEmail.value.trim();
    const password = signinPassword.value;
    if (!email || !password) { showError('signinError', 'Enter details'); return; }

    isAuthFlowActive = true;
    try {
        const result = await auth.signInWithEmailAndPassword(email, password);
        await performSmartRedirect(result.user);
    } catch (err) {
        isAuthFlowActive = false;
        showError('signinError', err.message);
    }
}

async function googleLogin() {
    isAuthFlowActive = true;
    try {
        const provider = new firebase.auth.GoogleAuthProvider();
        const result = await auth.signInWithPopup(provider);
        await performSmartRedirect(result.user);
    } catch (err) {
        isAuthFlowActive = false;
        alert("Google Login failed: " + err.message);
    }
}

async function appleLogin() {
    isAuthFlowActive = true;
    try {
        const provider = new firebase.auth.OAuthProvider('apple.com');
        const result = await auth.signInWithPopup(provider);
        await performSmartRedirect(result.user);
    } catch (err) {
        isAuthFlowActive = false;
        alert("Apple Login failed: " + err.message);
    }
}

async function facebookLogin() {
    isAuthFlowActive = true;
    try {
        const provider = new firebase.auth.FacebookAuthProvider();
        const result = await auth.signInWithPopup(provider);
        await performSmartRedirect(result.user);
    } catch (err) {
        isAuthFlowActive = false;
        alert("Facebook Login failed: " + err.message);
    }
}

async function forgotPassword() {
    const email = signinEmail.value.trim();
    if (!email) { showError('signinError', 'Enter email first'); return; }
    try {
        await auth.sendPasswordResetEmail(email);
        showError('signinError', '‚úÖ Check inbox for reset link.');
    } catch (err) { showError('signinError', err.message); }
}

/* --- AUTO-GATEKEEPER --- */
auth.onAuthStateChanged(user => {
    // If a button was just clicked, let that function handle the first redirect.
    // If the user just opened the browser/refreshed, check DB status immediately.
    if (isAuthFlowActive) return;
    if (user) {
        performSmartRedirect(user);
    }
});
</script>
</body>
</html>
