<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultra AI Barcode Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: Inter, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#scanner {
  position: relative;
  width: 100%;
  max-width: 600px;
  height: 420px;
  border-radius: 16px;
  overflow: hidden;
  border: 3px solid #00ff55;
}

video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Green scan box */
.scan-box {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 10%;
  right: 10%;
  border: 3px dashed #00ff55;
  z-index: 5;
}

/* Laser */
.laser {
  position: absolute;
  width: 100%;
  height: 3px;
  background: red;
  animation: scan 1s linear infinite;
  z-index: 6;
}

@keyframes scan {
  0% { top: 0; }
  50% { top: 100%; }
  100% { top: 0; }
}

#log {
  margin-top: 15px;
  width: 100%;
  max-width: 600px;
  background: #222;
  padding: 10px;
  border-radius: 12px;
  min-height: 120px;
  overflow-y: auto;
}

button {
  margin-top: 12px;
  padding: 12px 20px;
  border-radius: 14px;
  border: none;
  font-weight: bold;
  cursor: pointer;
  background: #00ff55;
  color: black;
}
</style>
</head>

<body>

<h2>ðŸ”¥ AI Barcode Scanner (FAST)</h2>

<div id="scanner">
  <video id="video" autoplay muted playsinline></video>
  <div class="scan-box"></div>
  <div class="laser"></div>
</div>

<div id="log"></div>

<button onclick="startScanner()">START</button>
<button onclick="stopScanner()">STOP</button>

<script>
let video = document.getElementById("video");
let scanning = false;
let lastScan = 0;
let lastCode = null;

function log(text) {
  const div = document.createElement("div");
  div.textContent = `${new Date().toLocaleTimeString()} â†’ ${text}`;
  document.getElementById("log").prepend(div);
}

// ðŸ”¥ START CAMERA
async function startScanner() {
  if (!('BarcodeDetector' in window)) {
    alert("BarcodeDetector API not supported on this browser.");
    return;
  }

  const stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: "environment",
      width: { ideal: 1920 },
      height: { ideal: 1080 }
    }
  });

  video.srcObject = stream;
  scanning = true;

  const detector = new BarcodeDetector({
    formats: ["ean_13", "ean_8", "upc_a", "code_128", "code_39"]
  });

  scanLoop(detector);
}

async function scanLoop(detector) {
  if (!scanning) return;

  try {
    const barcodes = await detector.detect(video);

    for (const barcode of barcodes) {
      const now = Date.now();

      // Ignore duplicates
      if (barcode.rawValue === lastCode && now - lastScan < 1200) continue;

      lastCode = barcode.rawValue;
      lastScan = now;

      log(`âœ… SCANNED: ${barcode.rawValue}`);
    }
  } catch (e) {}

  requestAnimationFrame(() => scanLoop(detector));
}

function stopScanner() {
  scanning = false;
  const stream = video.srcObject;
  if (stream) {
    stream.getTracks().forEach(track => track.stop());
  }
  log("â›” Scanner stopped");
}
</script>

</body>
</html>
