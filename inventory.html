<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inventory</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Inter}
body{
  margin:0;
  background:#f6f7fb;
  padding:30px;
}

/* HEADER */
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}
.top h2{margin:0;font-size:22px}
.top button{
  padding:12px 18px;
  border:none;
  border-radius:14px;
  background:#000;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

/* STATS */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:30px;
}
.stat{
  background:#fff;
  padding:22px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.06);
}
.stat span{color:#666;font-size:14px}
.stat h3{margin:8px 0 0;font-size:26px}

/* TABLE */
.table{
  background:#fff;
  border-radius:22px;
  box-shadow:0 15px 35px rgba(0,0,0,.08);
  overflow:hidden;
}
.head,.row{
  display:grid;
  grid-template-columns:2fr 1fr 1fr 2fr;
  padding:16px 22px;
  align-items:center;
}
.head{
  background:#f1f3f7;
  font-weight:600;
}
.row:not(:last-child){border-bottom:1px solid #eee}

/* STATUS */
.status.ok{color:#16a34a}
.status.low{color:#d97706}
.status.out{color:#dc2626}

/* ACTIONS */
.actions button{
  margin-right:6px;
  padding:6px 12px;
  border-radius:10px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
}
.actions .remove{
  color:#dc2626;
  border-color:#dc2626;
}

/* MODAL */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-box{
  width:380px;
  background:#fff;
  padding:28px;
  border-radius:22px;
}
.modal-box h3{margin-top:0}
.modal-box input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
  margin-bottom:12px;
}
.modal-box button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#000;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="top">
  <h2 id="businessName">Inventory</h2>
  <button onclick="openModal()">Add Product</button>
</div>

<!-- STATS -->
<div class="stats">
  <div class="stat"><span>Total Products</span><h3 id="total">0</h3></div>
  <div class="stat"><span>Low in quantity</span><h3 id="low">0</h3></div>
  <div class="stat"><span>Out of Stock</span><h3 id="out">0</h3></div>
</div>

<!-- TABLE -->
<div class="table">
  <div class="head">
    <div>Product</div>
    <div>Quantity</div>
    <div>Status</div>
    <div>Actions</div>
  </div>
  <div id="products"></div>
</div>

<!-- ADD PRODUCT MODAL -->
<div id="modal">
  <div class="modal-box">
    <h3>Add Product</h3>
<button onclick="openScanner()">Scan Barcode</button>

    <input id="pname" placeholder="Product name">
    <input id="pqty" type="number" placeholder="Quantity">
    <input id="punit" placeholder="Unit (kg, gm, pcsâ€¦)">
    <button onclick="addProduct()">Save Product</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD6PdrKp2XLfRqjC587lMpdKTaWD4MBens",
  authDomain: "scalevest-163a0.firebaseapp.com",
  databaseURL: "https://scalevest-163a0-default-rtdb.firebaseio.com",
  projectId: "scalevest-163a0"
});

const auth = firebase.auth();
const db = firebase.database();

let inventory = {};
let invRef;

/* AUTH + BUSINESS */
auth.onAuthStateChanged(user=>{
  if(!user){ location.href="login.html"; return; }

  const businessId = user.uid;
  invRef = db.ref(`Businesses/${businessId}/inventory`);

  db.ref(`BusinessOwners/${businessId}/businessName`)
    .once("value")
    .then(s=> document.getElementById("businessName").textContent = s.val() || "Inventory");

  invRef.on("value",snap=>{
    inventory = snap.val() || {};
    render();
  });
});

/* MODAL */
function openModal(){ document.getElementById("modal").style.display="flex"; }
function closeModal(){ document.getElementById("modal").style.display="none"; }

/* ADD PRODUCT */
function addProduct(){
  const name=pname.value.trim();
  const qty=parseFloat(pqty.value);
  const unit=punit.value.trim();
  if(!name||isNaN(qty)||!unit) return alert("Fill all fields");

  invRef.push({name,quantity:qty,unit,createdAt:Date.now()});
  pname.value=pqty.value=punit.value="";
  closeModal();
}

/* UPDATE QTY */
function updateQty(id,type){
  const amt=parseFloat(prompt("Enter amount"));
  if(isNaN(amt)||amt<=0) return;
  let q=inventory[id].quantity;
  q = type==="inc" ? q+amt : Math.max(0,q-amt);
  invRef.child(id).update({quantity:q});
}

/* REMOVE */
function removeProduct(id){
  if(confirm("Remove product?")) invRef.child(id).remove();
}

/* RENDER */
function render(){
  products.innerHTML="";
  let lowC=0,outC=0;

  Object.entries(inventory).forEach(([id,p])=>{
    let status="In Stock",cls="ok";
    if(p.quantity===0){status="Out of Stock";cls="out";outC++}
    else if(p.quantity<10){status="Low in quantity";cls="low";lowC++}

    products.innerHTML+=`
      <div class="row">
        <div>${p.name}</div>
        <div>${p.quantity} ${p.unit}</div>
        <div class="status ${cls}">${status}</div>
        <div class="actions">
          <button onclick="updateQty('${id}','inc')">Increase</button>
          <button onclick="updateQty('${id}','dec')">Decrease</button>
          <button class="remove" onclick="removeProduct('${id}')">Remove</button>
        </div>
      </div>`;
  });

  total.textContent=Object.keys(inventory).length;
  low.textContent=lowC;
  out.textContent=outC;
}
</script>

</body>
</html>
